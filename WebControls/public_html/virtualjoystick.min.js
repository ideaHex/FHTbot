
var VirtualJoystick=function(b){b=b||{};this._container=b.container||document.body;this._strokeStyle=b.strokeStyle||"cyan";this._stickEl=b.stickElement||this._buildJoystickStick();this._baseEl=b.baseElement||this._buildJoystickBase();this._mouseSupport=b.mouseSupport!==undefined?b.mouseSupport:false;this._stationaryBase=b.stationaryBase||false;this._baseX=this._stickX=b.baseX||0;this._baseY=this._stickY=b.baseY||0;this._limitStickTravel=b.limitStickTravel||false;this._stickRadius=b.stickRadius!==undefined?b.stickRadius:100;this._useCssTransform=b.useCssTransform!==undefined?b.useCssTransform:false;this._container.style.position="relative";this._container.appendChild(this._baseEl);this._baseEl.style.position="absolute";this._baseEl.style.display="none";this._container.appendChild(this._stickEl);this._stickEl.style.position="absolute";this._stickEl.style.display="none";this._pressed=false;this._touchIdx=null;if(this._stationaryBase===true){this._baseEl.style.display="";this._baseEl.style.left=(this._baseX-this._baseEl.width/2)+"px";this._baseEl.style.top=(this._baseY-this._baseEl.height/2)+"px"}this._transform=this._useCssTransform?this._getTransformProperty():false;this._has3d=this._check3D();var a=function(c,d){return function(){return c.apply(d,arguments)}};this._$onTouchStart=a(this._onTouchStart,this);this._$onTouchEnd=a(this._onTouchEnd,this);this._$onTouchMove=a(this._onTouchMove,this);this._container.addEventListener("touchstart",this._$onTouchStart,false);this._container.addEventListener("touchend",this._$onTouchEnd,false);this._container.addEventListener("touchmove",this._$onTouchMove,false);if(this._mouseSupport){this._$onMouseDown=a(this._onMouseDown,this);this._$onMouseUp=a(this._onMouseUp,this);this._$onMouseMove=a(this._onMouseMove,this);this._container.addEventListener("mousedown",this._$onMouseDown,false);this._container.addEventListener("mouseup",this._$onMouseUp,false);this._container.addEventListener("mousemove",this._$onMouseMove,false)}};VirtualJoystick.prototype.destroy=function(){this._container.removeChild(this._baseEl);this._container.removeChild(this._stickEl);this._container.removeEventListener("touchstart",this._$onTouchStart,false);this._container.removeEventListener("touchend",this._$onTouchEnd,false);this._container.removeEventListener("touchmove",this._$onTouchMove,false);if(this._mouseSupport){this._container.removeEventListener("mouseup",this._$onMouseUp,false);this._container.removeEventListener("mousedown",this._$onMouseDown,false);this._container.removeEventListener("mousemove",this._$onMouseMove,false)}};VirtualJoystick.touchScreenAvailable=function(){return"createTouch" in document?true:false};(function(a){a.addEventListener=function(c,b){if(this._events===undefined){this._events={}}this._events[c]=this._events[c]||[];this._events[c].push(b);return b};a.removeEventListener=function(c,b){if(this._events===undefined){this._events={}}if(c in this._events===false){return}this._events[c].splice(this._events[c].indexOf(b),1)};a.dispatchEvent=function(e){if(this._events===undefined){this._events={}}if(this._events[e]===undefined){return}var d=this._events[e].slice();for(var c=0;c<d.length;c++){var b=d[c].apply(this,Array.prototype.slice.call(arguments,1));if(b!==undefined){return b}}return undefined}})(VirtualJoystick.prototype);VirtualJoystick.prototype.deltaX=function(){return this._stickX-this._baseX};VirtualJoystick.prototype.deltaY=function(){return this._stickY-this._baseY};VirtualJoystick.prototype.up=function(){if(this._pressed===false){return false}var b=this.deltaX();var a=this.deltaY();if(a>=0){return false}if(Math.abs(b)>2*Math.abs(a)){return false}return true};VirtualJoystick.prototype.down=function(){if(this._pressed===false){return false}var b=this.deltaX();var a=this.deltaY();if(a<=0){return false}if(Math.abs(b)>2*Math.abs(a)){return false}return true};VirtualJoystick.prototype.right=function(){if(this._pressed===false){return false}var b=this.deltaX();var a=this.deltaY();if(b<=0){return false}if(Math.abs(a)>2*Math.abs(b)){return false}return true};VirtualJoystick.prototype.left=function(){if(this._pressed===false){return false}var b=this.deltaX();var a=this.deltaY();if(b>=0){return false}if(Math.abs(a)>2*Math.abs(b)){return false}return true};VirtualJoystick.prototype._onUp=function(){this._pressed=false;this._stickEl.style.display="none";if(this._stationaryBase===false){this._baseEl.style.display="none";this._baseX=this._baseY=0;this._stickX=this._stickY=0}};VirtualJoystick.prototype._onDown=function(b,g){this._pressed=true;if(this._stationaryBase===false){this._baseX=b;this._baseY=g;this._baseEl.style.display="";this._move(this._baseEl.style,(this._baseX-this._baseEl.width/2),(this._baseY-this._baseEl.height/2))}this._stickX=b;this._stickY=g;if(this._limitStickTravel===true){var c=this.deltaX();var a=this.deltaY();var d=Math.sqrt((c*c)+(a*a));if(d>this._stickRadius){var f=c/d;var e=a/d;this._stickX=f*this._stickRadius+this._baseX;this._stickY=e*this._stickRadius+this._baseY}}this._stickEl.style.display="";this._move(this._stickEl.style,(this._stickX-this._stickEl.width/2),(this._stickY-this._stickEl.height/2))};VirtualJoystick.prototype._onMove=function(b,g){if(this._pressed===true){this._stickX=b;this._stickY=g;if(this._limitStickTravel===true){var c=this.deltaX();var a=this.deltaY();var d=Math.sqrt((c*c)+(a*a));if(d>this._stickRadius){var f=c/d;var e=a/d;this._stickX=f*this._stickRadius+this._baseX;this._stickY=e*this._stickRadius+this._baseY}}this._move(this._stickEl.style,(this._stickX-this._stickEl.width/2),(this._stickY-this._stickEl.height/2))}};VirtualJoystick.prototype._onMouseUp=function(a){return this._onUp()};VirtualJoystick.prototype._onMouseDown=function(b){b.preventDefault();var a=b.clientX;var c=b.clientY;return this._onDown(a,c)};VirtualJoystick.prototype._onMouseMove=function(b){var a=b.clientX;var c=b.clientY;return this._onMove(a,c)};VirtualJoystick.prototype._onTouchStart=function(b){if(this._touchIdx!==null){return}var c=this.dispatchEvent("touchStartValidation",b);if(c===false){return}this.dispatchEvent("touchStart",b);b.preventDefault();var e=b.changedTouches[0];this._touchIdx=e.identifier;var a=e.pageX;var d=e.pageY;return this._onDown(a,d)};VirtualJoystick.prototype._onTouchEnd=function(c){if(this._touchIdx===null){return}this.dispatchEvent("touchEnd",c);var b=c.changedTouches;for(var a=0;a<b.length&&b[a].identifier!==this._touchIdx;a++){}if(a===b.length){return}this._touchIdx=null;c.preventDefault();return this._onUp()};VirtualJoystick.prototype._onTouchMove=function(d){if(this._touchIdx===null){return}var c=d.changedTouches;for(var b=0;b<c.length&&c[b].identifier!==this._touchIdx;b++){}if(b===c.length){return}var f=c[b];d.preventDefault();var a=f.pageX;var e=f.pageY;return this._onMove(a,e)};VirtualJoystick.prototype._buildJoystickBase=function(){var b=document.createElement("canvas");b.width=126;b.height=126;var a=b.getContext("2d");a.beginPath();a.strokeStyle=this._strokeStyle;a.lineWidth=6;a.arc(b.width/2,b.width/2,40,0,Math.PI*2,true);a.stroke();a.beginPath();a.strokeStyle=this._strokeStyle;a.lineWidth=2;a.arc(b.width/2,b.width/2,60,0,Math.PI*2,true);a.stroke();return b};VirtualJoystick.prototype._buildJoystickStick=function(){var b=document.createElement("canvas");b.width=86;b.height=86;var a=b.getContext("2d");a.beginPath();a.strokeStyle=this._strokeStyle;a.lineWidth=6;a.arc(b.width/2,b.width/2,40,0,Math.PI*2,true);a.stroke();return b};VirtualJoystick.prototype._move=function(b,a,c){if(this._transform){if(this._has3d){b[this._transform]="translate3d("+a+"px,"+c+"px, 0)"}else{b[this._transform]="translate("+a+"px,"+c+"px)"}}else{b.left=a+"px";b.top=c+"px"}};VirtualJoystick.prototype._getTransformProperty=function(){var d=["webkitTransform","MozTransform","msTransform","OTransform","transform"];var c=document.createElement("p");var b;for(var a=0;a<d.length;a++){b=d[a];if(null!==c.style[b]){return b}}};VirtualJoystick.prototype._check3D=function(){var e=this._getTransformProperty();if(!e||!window.getComputedStyle){return module.exports=false}var c={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};var b=document.createElement("div");b.style[e]="translate3d(1px,1px,1px)";document.body.insertBefore(b,null);var d=getComputedStyle(b).getPropertyValue(c[e]);document.body.removeChild(b);var a=null!==d&&d.length&&"none"!==d;return a};